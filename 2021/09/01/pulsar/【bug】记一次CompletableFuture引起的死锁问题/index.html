<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="记一次CompletableFuture引起的死锁问题"><meta name="keywords" content="pulsar"><meta name="author" content="iMine"><meta name="copyright" content="iMine"><title>记一次CompletableFuture引起的死锁问题 | iMineのBlog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?434d6055a3a5266f2c2a21749e588070";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-背景"><span class="toc-text">1. 背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-问题分析"><span class="toc-text">2. 问题分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-定位代码"><span class="toc-text">2.1 定位代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-查看进程和cpu使用情况"><span class="toc-text">2.2 查看进程和cpu使用情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-查看堆栈信息"><span class="toc-text">2.3 查看堆栈信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-问题解决"><span class="toc-text">3. 问题解决</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-问题总结"><span class="toc-text">4. 问题总结</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">iMine</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/iMine141" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">74</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">24</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://github.com/iMine141" target="_blank" rel="noopener">iMine</a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">iMineのBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/about">About</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">记一次CompletableFuture引起的死锁问题</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-01</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/pulsar/">pulsar</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">1.6k</span><span class="post-meta__separator">|</span><span>Reading time: 8 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h1><p>在pulsar中添加只读broker功能的支持，所以修改了pulsar-broker的代码，在创建cursor时添加了zk查询代码。</p>
<p>然后测试的时候发现，每一次重新创建topic，consumer开始订阅消息后，broker就会出现阻塞，导致subscribe阶段一直不成功。</p>
<h1 id="2-问题分析"><a href="#2-问题分析" class="headerlink" title="2. 问题分析"></a>2. 问题分析</h1><p>consumer和pulsar之间进行交互的阶段有：</p>
<ul>
<li><p>CONNECT</p>
</li>
<li><p>PARTITIONED_METADATA</p>
</li>
<li><p>LOOKUP</p>
</li>
<li><p>SUBSCRIBE</p>
</li>
</ul>
<p>然后当consumer发送SUBSCRIBE后，一直收不到broker的应答，由此确认broker处理SUBSCRIBE出现问题。</p>
<h2 id="2-1-定位代码"><a href="#2-1-定位代码" class="headerlink" title="2.1 定位代码"></a>2.1 定位代码</h2><p>通过查看pulsar的源码，可以看到对于zk数据的查询都是异步执行的，而且共用的一个线程，如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; AbstractMetadataStore 构造方法</span><br><span class="line">protected AbstractMetadataStore() &#123;</span><br><span class="line">        this.executor &#x3D; Executors</span><br><span class="line">                .newSingleThreadExecutor(new DefaultThreadFactory(&quot;metadata-store&quot;));</span><br><span class="line">        registerListener(this);</span><br><span class="line"> &#x2F;&#x2F; other code   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 执行查询或者回调函数</span><br><span class="line">&#x2F;**</span><br><span class="line">  * Run the task in the executor thread and fail the future if the executor is shutting down</span><br><span class="line">  *&#x2F;</span><br><span class="line">protected void execute(Runnable task, CompletableFuture&lt;?&gt; future) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        executor.execute(task);</span><br><span class="line">    &#125; catch (Throwable t) &#123;</span><br><span class="line">        future.completeExceptionally(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以猜测是由于回调函数没有执行完毕导致的阻塞，因此在所有的回调函数出打印日志，定位到如下代码出现阻塞：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">public CompletableFuture&lt;Stat&gt; storePut(String path, byte[] value, Optional&lt;Long&gt; optExpectedVersion,</span><br><span class="line">    EnumSet&lt;CreateOption&gt; options) &#123;</span><br><span class="line">  boolean hasVersion &#x3D; optExpectedVersion.isPresent();</span><br><span class="line">  int expectedVersion &#x3D; optExpectedVersion.orElse(-1L).intValue();</span><br><span class="line"></span><br><span class="line">  CompletableFuture&lt;Stat&gt; future &#x3D; new CompletableFuture&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    if (hasVersion &amp;&amp; expectedVersion &#x3D;&#x3D; -1) &#123;</span><br><span class="line">      CreateMode createMode &#x3D; getCreateMode(options);</span><br><span class="line">      ZkUtils.asyncCreateFullPathOptimistic(zkc, path, value, ZooDefs.Ids.OPEN_ACL_UNSAFE,</span><br><span class="line">          createMode, (rc, path1, ctx, name) -&gt; &#123;</span><br><span class="line">            execute(() -&gt; &#123;</span><br><span class="line">              Code code &#x3D; Code.get(rc);</span><br><span class="line">              if (code &#x3D;&#x3D; Code.OK) &#123;</span><br><span class="line">                                &#x2F;&#x2F; 运行到此处时出现阻塞。</span><br><span class="line">                future.complete(new Stat(name, 0, 0, 0, createMode.isEphemeral(), true));</span><br><span class="line">              &#125; else if (code &#x3D;&#x3D; Code.NODEEXISTS) &#123;</span><br><span class="line">                &#x2F;&#x2F; We&#39;re emulating a request to create node, so the version is invalid</span><br><span class="line">                future.completeExceptionally(getException(Code.BADVERSION, path));</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                future.completeExceptionally(getException(code, path));</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;, future);</span><br><span class="line">          &#125;, null);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      &#x2F;&#x2F; other code...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (Throwable t) &#123;</span><br><span class="line">    future.completeExceptionally(new MetadataStoreException(t));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return future;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-查看进程和cpu使用情况"><a href="#2-2-查看进程和cpu使用情况" class="headerlink" title="2.2 查看进程和cpu使用情况"></a>2.2 查看进程和cpu使用情况</h2><p>然后查询进程和cpu使用情况：</p>
<p># 找到进程ID</p>
<p>ps -ef |grep broker</p>
<p># 查询进程cpu</p>
<p>top -Hp 16704</p>
<p><img src="/2021/09/01/pulsar/%E3%80%90bug%E3%80%91%E8%AE%B0%E4%B8%80%E6%AC%A1CompletableFuture%E5%BC%95%E8%B5%B7%E7%9A%84%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98/image-20240519001339974.png" alt="image-20240519001339974"></p>
<p>看到cpu使用的并不多，再10%以下，由此可推断不是gc或者其他死循环造成的阻塞。</p>
<h2 id="2-3-查看堆栈信息"><a href="#2-3-查看堆栈信息" class="headerlink" title="2.3 查看堆栈信息"></a>2.3 查看堆栈信息</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;metadata-store-7-1&quot; #84 prio&#x3D;5 os_prio&#x3D;0 tid&#x3D;0x00007f1560004800 nid&#x3D;0x1ca1 waiting on condition [0x00007f1506a2c000]</span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">  at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">  - parking to wait for  &lt;0x00000000fd0c3d18&gt; (a java.util.concurrent.CompletableFuture$Signaller)</span><br><span class="line">  at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">  at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1693)</span><br><span class="line">  at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)</span><br><span class="line">  at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1729)</span><br><span class="line">  at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)</span><br><span class="line">  at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.recoverCursorFromZK(ManagedLedgerImpl.java:1072)</span><br><span class="line">  at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.asyncOpenCursor(ManagedLedgerImpl.java:1019)</span><br><span class="line">    &#x2F;&#x2F; 阻塞原因</span><br><span class="line">  - locked &lt;0x00000000f5841ce8&gt; (a org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl)</span><br><span class="line">  at org.apache.pulsar.broker.service.persistent.PersistentTopic.getDurableSubscription(PersistentTopic.java:857)</span><br><span class="line">  at org.apache.pulsar.broker.service.persistent.PersistentTopic.subscribe(PersistentTopic.java:747)</span><br><span class="line">  at org.apache.pulsar.broker.service.ServerCnx.lambda$null$12(ServerCnx.java:1050)</span><br><span class="line">  at org.apache.pulsar.broker.service.ServerCnx$$Lambda$277&#x2F;1382611823.apply(Unknown Source)</span><br><span class="line">  at java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:952)</span><br><span class="line">  at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:926)</span><br><span class="line">  at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)</span><br><span class="line">  at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962)</span><br><span class="line">  at org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage$$Lambda$295&#x2F;640790180.accept(Unknown Source)</span><br><span class="line">  at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:656)</span><br><span class="line">  at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632)</span><br><span class="line">  at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)</span><br><span class="line">  at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962)</span><br><span class="line">    &#x2F;&#x2F; 阻塞代码</span><br><span class="line">  at org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$null$15(ZKMetadataStore.java:234)</span><br><span class="line">  at org.apache.pulsar.metadata.impl.ZKMetadataStore$$Lambda$127&#x2F;153703270.run(Unknown Source)</span><br><span class="line">  at org.apache.pulsar.metadata.impl.AbstractMetadataStore.lambda$execute$8(AbstractMetadataStore.java:261)</span><br><span class="line">  at org.apache.pulsar.metadata.impl.AbstractMetadataStore$$Lambda$128&#x2F;1782705605.run(Unknown Source)</span><br><span class="line">  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">  at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)</span><br><span class="line">  at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">&quot;main-EventThread&quot; #82 daemon prio&#x3D;5 os_prio&#x3D;0 tid&#x3D;0x00007f15edd8e800 nid&#x3D;0x1ca0 waiting on condition [0x00007f150692c000]</span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">  at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">  - parking to wait for  &lt;0x00000000f5840660&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)</span><br><span class="line">  at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">  at java.util.concurrent.locks.AbstractQue</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)</span><br><span class="line">	at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)</span><br><span class="line">	at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:559)</span><br><span class="line"></span><br><span class="line">&quot;main-SendThread(172.20.140.23:2181)&quot; #81 daemon prio&#x3D;5 os_prio&#x3D;0 tid&#x3D;0x00007f15edd8a800 nid&#x3D;0x1c9f runnable [0x00007f150672a000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">	at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)</span><br><span class="line">	at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)</span><br><span class="line">	at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:93)</span><br><span class="line">	at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86)</span><br><span class="line">	- locked &lt;0x00000000f571b3e8&gt; (a sun.nio.ch.Util$3)</span><br><span class="line">	- locked &lt;0x00000000f571b3f8&gt; (a java.util.Collections$UnmodifiableSet)</span><br><span class="line">	- locked &lt;0x00000000f571b3a0&gt; (a sun.nio.ch.EPollSelectorImpl)</span><br><span class="line">	at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97)</span><br><span class="line">	at org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:332)</span><br><span class="line">	at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1290)</span><br></pre></td></tr></table></figure>

<p>可以看到zk中代码出现阻塞的原因是和ManagedLedgerImpl中的代码出现了资源竞争，涉及到的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">private boolean recoverCursorFromZK(String cursorName, final OpenCursorCallback callback, final Object ctx) &#123;</span><br><span class="line">  CompletableFuture&lt;Boolean&gt; existsFuture &#x3D; new CompletableFuture&lt;&gt;();</span><br><span class="line">  store.asyncGetCursorInfo(name, cursorName, new MetaStoreCallback&lt;MLDataFormats.ManagedCursorInfo&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void operationComplete(MLDataFormats.ManagedCursorInfo info, Stat stat) &#123;</span><br><span class="line">      existsFuture.complete(true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void operationFailed(MetaStoreException e) &#123;</span><br><span class="line">      log.info(&quot;vvv method &#123;&#125; open failed&quot;, &quot;recoverCursorFromZK&quot;);</span><br><span class="line">      existsFuture.complete(false);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">    </span><br><span class="line">  try &#123;</span><br><span class="line">        &#x2F;&#x2F; 阻塞的原因是因为这条语句</span><br><span class="line">    if (!existsFuture.get()) &#123;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (Exception e) &#123;</span><br><span class="line">    log.error(&quot;vvv method recoverCursorFromZK error&quot;, e);</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; other code</span><br><span class="line">  </span><br><span class="line">  return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-问题解决"><a href="#3-问题解决" class="headerlink" title="3. 问题解决"></a>3. 问题解决</h1><p>修改recoverCursorFromZK方法，把通过get进行任务执行完毕的判断改为confuture.thenAccept()。</p>
<h1 id="4-问题总结"><a href="#4-问题总结" class="headerlink" title="4. 问题总结"></a>4. 问题总结</h1><p>其实最后也没发现为什么出现资源竞争，好像就是在一个线程中使用CompletableFuture就出现了问题。</p>
<p>整个代码的逻辑是：</p>
<ul>
<li><p>通过zk查询数据，设置回调方法等待zk查询完成后执行。</p>
</li>
<li><p>zk查询完成后，通过唯一的线程执行回调方法，回调方法中就是future.complete()。</p>
</li>
<li><p>另外的线程开始执行同样的查询，回调方法同样是future.complete()，只不过还有其他线程调用了future.get()。</p>
</li>
</ul>
<p>流程就像下面这种：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public void testFuture() throws Exception &#123;</span><br><span class="line">  ExecutorService executor &#x3D; Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">  CompletableFuture&lt;Boolean&gt; f1 &#x3D; new CompletableFuture&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  new Thread(() -&gt; &#123;</span><br><span class="line">    CompletableFuture&lt;Boolean&gt; f2 &#x3D; new CompletableFuture&lt;&gt;();</span><br><span class="line">    executor.execute(() -&gt; &#123;</span><br><span class="line">      sleep(1000);</span><br><span class="line"></span><br><span class="line">      System.out.println(&quot;f2 start&quot;);</span><br><span class="line">      f2.complete(true);</span><br><span class="line">      System.out.println(&quot;f2 done&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    executor.execute(() -&gt; &#123;</span><br><span class="line">      sleep(1000);</span><br><span class="line"></span><br><span class="line">      System.out.println(&quot;f1 start&quot;);</span><br><span class="line">      f1.complete(true);</span><br><span class="line">      System.out.println(&quot;f1 done&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).start();</span><br><span class="line"></span><br><span class="line">  System.out.println(&quot;init done&quot;);</span><br><span class="line">  f1.get();</span><br><span class="line">  System.out.println(&quot;run done&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void sleep(int i) &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    Thread.sleep(1000);</span><br><span class="line">  &#125; catch (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">iMine</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://imine141.github.io/2021/09/01/pulsar/%E3%80%90bug%E3%80%91%E8%AE%B0%E4%B8%80%E6%AC%A1CompletableFuture%E5%BC%95%E8%B5%B7%E7%9A%84%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98/">https://imine141.github.io/2021/09/01/pulsar/%E3%80%90bug%E3%80%91%E8%AE%B0%E4%B8%80%E6%AC%A1CompletableFuture%E5%BC%95%E8%B5%B7%E7%9A%84%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pulsar/">pulsar</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/09/02/pulsar/%E5%8F%AA%E8%AF%BBbroker%E8%AE%BE%E8%AE%A1%EF%BC%88%E4%B8%80%EF%BC%89/"><i class="fa fa-chevron-left">  </i><span>只读broker设计（一）</span></a></div><div class="next-post pull-right"><a href="/2021/08/23/pulsar/pulsar%E6%B6%88%E8%B4%B9%E8%BF%9B%E5%BA%A6%E4%BF%9D%E5%AD%98%EF%BC%88%E4%BA%8C%EF%BC%89/"><span>pulsar消费进度保存（二）</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '316d899c68e414a53017',
  clientSecret: 'e63edfd4dd96b3b665a0a561e2ce048c2b3f0a3b',
  repo: 'imine141.github.io',
  owner: 'imine141',
  admin: 'imine141',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2024 By iMine</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>